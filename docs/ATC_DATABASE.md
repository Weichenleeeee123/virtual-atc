# ATC 数据库系统

## 概述

Virtual ATC 现在包含完整的机场数据库，提供真实的航路、频率和机场信息。

## 功能特性

### 1. 自动机场检测

系统会根据飞机的经纬度自动检测最近的机场（50公里范围内）。

### 2. 机场信息

每个机场包含：
- **基本信息**：ICAO 代码、名称、海拔、坐标
- **跑道信息**：跑道号、航向、长度、宽度
- **通信频率**：塔台、地面、离场、进近、ATIS
- **标准程序**：SID（标准离场）、STAR（标准进场）

### 3. 预加载机场

系统预加载了中国主要机场：

#### 北京首都国际机场 (ZBAA)
- 位置：40.0801°N, 116.5846°E
- 海拔：116 米
- 跑道：01/19, 18L/36R, 18R/36L
- 塔台频率：118.5, 118.7 MHz
- 地面频率：121.6, 121.75 MHz
- 离场频率：125.75, 124.6 MHz
- 进近频率：119.7, 124.5 MHz

#### 上海浦东国际机场 (ZSPD)
- 位置：31.1434°N, 121.8052°E
- 海拔：13 米
- 跑道：16L/34R, 16R/34L, 17L/35R
- 塔台频率：118.8, 124.45 MHz
- 地面频率：121.65, 121.95 MHz
- 离场频率：120.85, 125.65 MHz
- 进近频率：119.4, 120.4 MHz

#### 广州白云国际机场 (ZGGG)
- 位置：23.3924°N, 113.2988°E
- 海拔：50 米
- 跑道：02L/20R, 02R/20L
- 塔台频率：118.2, 118.95 MHz
- 地面频率：121.6, 121.85 MHz
- 离场频率：119.0, 125.4 MHz
- 进近频率：119.85, 120.6 MHz

#### 成都双流国际机场 (ZUUU)
- 位置：30.5785°N, 103.9468°E
- 海拔：1625 米
- 跑道：02L/20R, 02R/20L
- 塔台频率：118.3, 118.65 MHz
- 地面频率：121.7, 121.85 MHz
- 离场频率：119.25, 125.1 MHz
- 进近频率：119.1, 120.3 MHz

## ATC 指令示例

### 停机位推出
```
飞行员："国航123，请求推出"
ATC："国航123，推出许可，面向北，联系地面121.6"
```

### 滑行指令
```
飞行员："国航123，地面，请求滑行"
ATC："国航123，地面，滑行至跑道01等待点，跑道01"
```

### 起飞许可
```
飞行员："国航123，准备起飞"
ATC："国航123，跑道01，可以起飞，离场后联系离场125.75"
```

### 离场指令
```
飞行员："国航123，离场"
ATC："国航123，离场，爬升至3000米，按照BOBAK1A离场"
```

### 巡航指令
```
飞行员："国航123，请求航向"
ATC："国航123，左转航向270，保持9000米"
```

### 进近指令
```
飞行员："国航123，请求进近"
ATC："国航123，联系进近119.7，按照AKOMA1A进近"
```

### 着陆许可
```
飞行员："国航123，请求着陆"
ATC："国航123，跑道01，可以着陆，地面风090度5米"
```

## 频率管理

系统会在适当时机自动提示频率切换：

1. **推出后** → 地面频率
2. **起飞后** → 离场频率
3. **巡航时** → 区域管制频率
4. **进近前** → 进近频率
5. **着陆后** → 地面频率

## 扩展机场

要添加新机场，编辑 `src-tauri/src/modules/atc_database.rs`：

```rust
self.airports.insert("ICAO".to_string(), Airport {
    icao: "ICAO".to_string(),
    name: "机场名称".to_string(),
    name_en: "Airport Name".to_string(),
    latitude: 0.0,
    longitude: 0.0,
    elevation: 0,
    runways: vec![
        Runway {
            name: "01/19".to_string(),
            heading_1: 10,
            heading_2: 190,
            length: 3800,
            width: 60,
        },
    ],
    frequencies: Frequencies {
        tower: vec![118.5],
        ground: vec![121.6],
        departure: vec![125.75],
        approach: vec![119.7],
        atis: vec![127.6],
    },
    sids: vec!["SID1".to_string()],
    stars: vec!["STAR1".to_string()],
});
```

## 数据来源

机场数据来源：
- ICAO AIP（航空情报汇编）
- 中国民航局 AIP
- X-Plane 机场数据库
- MSFS 机场数据库

## 注意事项

1. 频率数据仅供模拟使用，实际飞行请参考官方 AIP
2. SID/STAR 程序名称为示例，实际程序请参考航图
3. 系统会自动检测最近机场，无需手动选择
4. 如果飞机不在任何机场附近，ATC 会提示"未检测到机场"
